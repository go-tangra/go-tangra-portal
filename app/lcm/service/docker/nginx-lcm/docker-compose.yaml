# Docker Compose for LCM Nginx e2e testing
# Usage: docker compose up -d

services:
  nginx-lcm:
    build:
      context: ../../../..  # backend directory
      dockerfile: app/lcm/service/docker/nginx-lcm/Dockerfile
    image: menta2k/nginx-lcm:latest
    container_name: nginx-lcm-test
    ports:
      - "8880:80"
      - "8443:443"
    environment:
      # LCM server connection (optional - for full e2e testing)
      - LCM_SERVER=${LCM_SERVER:-localhost:9000}
      - LCM_CLIENT_ID=${LCM_CLIENT_ID:-nginx-e2e-test}
      # Optional: provide certificates directly for quick testing
      # - LCM_CERT_NAME=test.example.com
      # - LCM_CERT_PEM=<certificate PEM>
      # - LCM_KEY_PEM=<private key PEM>
      # - LCM_CHAIN_PEM=<chain PEM>
    volumes:
      # Persist LCM client data
      - lcm-data:/root/.lcm-client
      # Optional: mount custom nginx configs
      # - ./custom-nginx.conf:/etc/nginx/conf.d/custom.conf:ro
    networks:
      - lcm-test
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost/"]
      interval: 10s
      timeout: 3s
      retries: 3
      start_period: 5s

volumes:
  lcm-data:

networks:
  lcm-test:
    driver: bridge
