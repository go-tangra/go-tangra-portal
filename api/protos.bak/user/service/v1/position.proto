syntax = "proto3";

package user.service.v1;

import "gnostic/openapi/v3/annotations.proto";
import "google/protobuf/empty.proto";
import "google/protobuf/timestamp.proto";
import "google/protobuf/field_mask.proto";

import "pagination/v1/pagination.proto";

// Position service
service PositionService {
  // Query position list
  rpc List (pagination.PagingRequest) returns (ListPositionResponse) {}

  // Query position details
  rpc Get (GetPositionRequest) returns (Position) {}

  // Create position
  rpc Create (CreatePositionRequest) returns (google.protobuf.Empty) {}

  // Update position
  rpc Update (UpdatePositionRequest) returns (google.protobuf.Empty) {}

  // Delete position
  rpc Delete (DeletePositionRequest) returns (google.protobuf.Empty) {}

  // Batch create positions
  rpc BatchCreate (BatchCreatePositionsRequest) returns (BatchCreatePositionsResponse) {}
}

// Position
message Position {
  // Position status
  enum Status {
    OFF = 0;     // Disabled
    ON = 1;      // Enabled
  }

  // Position type
  enum Type {
    REGULAR = 0;    // Regular position
    LEADER = 1;     // Leadership position
    MANAGER = 2;    // Management position
    INTERN = 3;     // Internship position
    CONTRACT = 4;   // Contract position

    OTHER = 100;     // Other position
  }

  optional uint32 id = 1 [
    json_name = "id",
    (gnostic.openapi.v3.property) = {description: "Position ID"}
  ];  // Position ID

  optional string name = 2 [json_name = "name", (gnostic.openapi.v3.property) = {description: "Position name"}];  // Position name
  optional string code = 3 [json_name = "code", (gnostic.openapi.v3.property) = {description: "Unique code (suggested format: department code + position type + sequence, e.g., 'FIN-LEADER-001'), used for data sync and quick identification"}];  // Unique code (suggested format: department code + position type + sequence, e.g., "FIN-LEADER-001"), used for data sync and quick identification

  optional uint32 headcount = 4 [
    json_name = "headcount",
    (gnostic.openapi.v3.property) = {description: "Headcount (maximum number of employees for this position, 0 means unlimited)"}
  ];  // Headcount (maximum number of employees for this position, 0 means unlimited)

  optional uint32 sort_order = 5 [
    json_name = "sortOrder",
    (gnostic.openapi.v3.property) = {description: "Sort order, smaller values appear first"}
  ];  // Sort order, smaller values appear first

  optional Status status = 6 [(gnostic.openapi.v3.property) = {description: "Status"}]; // Status
  optional Type type = 7 [json_name = "type", (gnostic.openapi.v3.property) = {description: "Position type"}];  // Position type

  optional string remark = 8 [
    json_name = "remark",
    (gnostic.openapi.v3.property) = {description: "Remark"}
  ];  // Remark
  optional string description = 9 [
    json_name = "description",
    (gnostic.openapi.v3.property) = {description: "Position description"}
  ];  // Position description

  optional string job_family = 10 [
    json_name = "jobFamily",
    (gnostic.openapi.v3.property) = {description: "Job family/sequence"}
  ];  // Job family/sequence
  optional string job_grade = 11 [
    json_name = "jobGrade",
    (gnostic.openapi.v3.property) = {description: "Job grade"}
  ];  // Job grade
  optional int32 level = 12 [
    json_name = "level",
    (gnostic.openapi.v3.property) = {description: "Numeric level"}
  ];  // Numeric level
  optional bool is_key_position = 13 [
    json_name = "isKeyPosition",
    (gnostic.openapi.v3.property) = {description: "Whether this is a key position"}
  ];  // Whether this is a key position

  optional uint32 tenant_id = 20 [
    json_name = "tenantId",
    (gnostic.openapi.v3.property) = {description: "Tenant ID"}
  ];  // Tenant ID
  optional string tenant_name = 21 [
    json_name = "tenantName",
    (gnostic.openapi.v3.property) = {description: "Tenant name"}
  ];  // Tenant name

  optional uint32 org_unit_id = 22 [
    json_name = "orgUnitId",
    (gnostic.openapi.v3.property) = {description: "Belonging organization unit ID"}
  ];  // Belonging organization unit ID
  optional string org_unit_name = 23 [
    json_name = "orgUnitName",
    (gnostic.openapi.v3.property) = {description: "Belonging organization unit name"}
  ];  // Belonging organization unit name

  optional uint32 reports_to_position_id = 24 [
    json_name = "reportsToPositionId",
    (gnostic.openapi.v3.property) = {description: "Reports to position ID"}
  ];  // Reports to position ID
  optional string reports_to_position_name = 25 [
    json_name = "reportsToPositionName",
    (gnostic.openapi.v3.property) = {description: "Reports to position name"}
  ];  // Reports to position name

  optional google.protobuf.Timestamp start_at = 50 [
    json_name = "startAt",
    (gnostic.openapi.v3.property) = {description: "Effective time (UTC)"}
  ];// Effective time

  optional google.protobuf.Timestamp end_at = 51 [
    json_name = "endAt",
    (gnostic.openapi.v3.property) = {description: "Expiration time (UTC)"}
  ];// Expiration time

  optional uint32 created_by = 100 [json_name = "createdBy", (gnostic.openapi.v3.property) = {description: "Creator ID"}]; // Creator ID
  optional uint32 updated_by = 101 [json_name = "updatedBy", (gnostic.openapi.v3.property) = {description: "Updater ID"}]; // Updater ID
  optional uint32 deleted_by = 102 [json_name = "deletedBy", (gnostic.openapi.v3.property) = {description: "Deleter user ID"}]; // Deleter user ID

  optional google.protobuf.Timestamp created_at = 200 [json_name = "createdAt", (gnostic.openapi.v3.property) = {description: "Created time"}];// Created time
  optional google.protobuf.Timestamp updated_at = 201 [json_name = "updatedAt", (gnostic.openapi.v3.property) = {description: "Updated time"}];// Updated time
  optional google.protobuf.Timestamp deleted_at = 202 [json_name = "deletedAt", (gnostic.openapi.v3.property) = {description: "Deleted time"}];// Deleted time
}

// List positions - Response
message ListPositionResponse {
  repeated Position items = 1;
  uint64 total = 2;
}

// Get position data - Request
message GetPositionRequest {
  oneof query_by {
    uint32 id = 1 [
      (gnostic.openapi.v3.property) = {description: "ID", read_only: true},
      json_name = "id"
    ]; // ID

    string name = 2 [
      (gnostic.openapi.v3.property) = {description: "Name", read_only: true},
      json_name = "name"
    ]; // Name

    string code = 3 [
      (gnostic.openapi.v3.property) = {description: "Unique code", read_only: true},
      json_name = "code"
    ]; // Unique code
  }

  optional google.protobuf.FieldMask view_mask = 100 [
    json_name = "viewMask",
    (gnostic.openapi.v3.property) = {
      description: "View field mask for controlling returned fields"
    }
  ]; // View field mask for controlling returned fields
}

// Create position - Request
message CreatePositionRequest {
  Position data = 1;
}

// Update position - Request
message UpdatePositionRequest {
  uint32 id = 1;

  Position data = 2;

  google.protobuf.FieldMask update_mask = 3 [
    (gnostic.openapi.v3.property) = {
      description: "List of fields to update",
      example: {yaml : "id,realname,username"}
    },
    json_name = "updateMask"
  ]; // List of fields to update

  optional bool allow_missing = 4 [
    (gnostic.openapi.v3.property) = {description: "If set to true and the resource does not exist, it will be created (inserted), and the `updateMask` field will be ignored."},
    json_name = "allowMissing"
  ]; // If set to true and the resource does not exist, it will be created (inserted), and the `updateMask` field will be ignored.
}

// Delete position - Request
message DeletePositionRequest {
  uint32 id = 1;
}

message BatchCreatePositionsRequest {
  repeated Position data = 1;
}
message BatchCreatePositionsResponse {
  repeated int32 created_ids = 1 [
    json_name = "createdIds",
    (gnostic.openapi.v3.property) = {
      description: "List of successfully created position IDs"
    }
  ]; // List of successfully created position IDs
}
