syntax = "proto3";

package authentication.service.v1;

import "gnostic/openapi/v3/annotations.proto";

import "google/api/annotations.proto";
import "google/api/field_behavior.proto";

import "google/protobuf/empty.proto";
import "google/protobuf/timestamp.proto";
import "google/protobuf/field_mask.proto";

import "pagination/v1/pagination.proto";

// Login policy management service
service LoginPolicyService {
  // Query login policy list
  rpc List (pagination.PagingRequest) returns (ListLoginPolicyResponse) {}

  // Query login policy details
  rpc Get (GetLoginPolicyRequest) returns (LoginPolicy) {}

  // Create login policy
  rpc Create (CreateLoginPolicyRequest) returns (google.protobuf.Empty) {}

  // Update login policy
  rpc Update (UpdateLoginPolicyRequest) returns (google.protobuf.Empty) {}

  // Delete login policy
  rpc Delete (DeleteLoginPolicyRequest) returns (google.protobuf.Empty) {}
}

// Login policy
message LoginPolicy {
  // Login policy type
  enum Type {
    LOGIN_RESTRICTION_TYPE_UNSPECIFIED = 0; // Unknown

    BLACKLIST = 1; // Blacklist
    WHITELIST = 2; // Whitelist
  }

  // Login policy method
  enum Method {
    LOGIN_RESTRICTION_METHOD_UNSPECIFIED = 0; // Unknown

    IP = 1; // IP address restriction
    MAC = 2; // MAC address restriction, binding device MAC address.
    REGION = 3; // Region restriction, restrict login based on geographic location (such as country, city).
    TIME = 4; // Time restriction, restrict login time periods, for example only allow login during work hours.
    DEVICE = 5; // Device restriction, restrict login device type (such as PC, mobile) or specific device ID.
  }

  optional uint32 id = 1 [
    json_name = "id",
    (google.api.field_behavior) = OPTIONAL,
    (gnostic.openapi.v3.property) = {
      description: "Login policy ID"
    }
  ]; // Login policy ID

  optional uint32 target_id = 2 [
    json_name = "targetId",
    (gnostic.openapi.v3.property) = {
      description: "Target user ID"
    }
  ]; // Target user ID

  optional Type type = 3 [
    json_name = "type",
    (gnostic.openapi.v3.property) = {
      description: "Restriction type"
    }
  ]; // Restriction type

  optional Method method = 4 [
    json_name = "method",
    (gnostic.openapi.v3.property) = {
      description: "Restriction method"
    }
  ]; // Restriction method

  optional string value = 5 [
    json_name = "value",
    (gnostic.openapi.v3.property) = {
      description: "Restriction value (such as IP address, MAC address or region code)"
    }
  ]; // Restriction value (such as IP address, MAC address or region code)

  optional string reason = 6 [
    json_name = "reason",
    (gnostic.openapi.v3.property) = { description: "Restriction reason" }
  ]; // Restriction reason

  optional uint32 tenant_id = 40 [
    json_name = "tenantId",
    (gnostic.openapi.v3.property) = {description: "Tenant ID, 0 represents system global role"}
  ];  // Tenant ID, 0 represents system global role
  optional string tenant_name = 41 [
    json_name = "tenantName",
    (gnostic.openapi.v3.property) = {description: "Tenant name"}
  ];  // Tenant name

  optional uint32 created_by = 100 [json_name = "createdBy", (gnostic.openapi.v3.property) = {description: "Creator ID"}]; // Creator ID
  optional uint32 updated_by = 101 [json_name = "updatedBy", (gnostic.openapi.v3.property) = {description: "Updater ID"}]; // Updater ID
  optional uint32 deleted_by = 102 [json_name = "deletedBy", (gnostic.openapi.v3.property) = {description: "Deleter user ID"}]; // Deleter user ID

  optional google.protobuf.Timestamp created_at = 200 [json_name = "createdAt", (gnostic.openapi.v3.property) = {description: "Created time"}];// Created time
  optional google.protobuf.Timestamp updated_at = 201 [json_name = "updatedAt", (gnostic.openapi.v3.property) = {description: "Updated time"}];// Updated time
  optional google.protobuf.Timestamp deleted_at = 202 [json_name = "deletedAt", (gnostic.openapi.v3.property) = {description: "Deleted time"}];// Deleted time
}

// Query login policy list - Response
message ListLoginPolicyResponse {
  repeated LoginPolicy items = 1;
  uint64 total = 2;
}

// Query login policy details - Request
message GetLoginPolicyRequest {
  oneof query_by {
    uint32 id = 1 [
      (gnostic.openapi.v3.property) = {description: "ID", read_only: true},
      json_name = "id"
    ]; // ID
  }

  optional google.protobuf.FieldMask view_mask = 100 [
    json_name = "viewMask",
    (gnostic.openapi.v3.property) = {
      description: "View field filter, used to control returned fields"
    }
  ]; // View field filter, used to control returned fields
}

// Create login policy - Request
message CreateLoginPolicyRequest {
  LoginPolicy data = 1;
}

// Update login policy - Request
message UpdateLoginPolicyRequest {
  uint32 id = 1;

  LoginPolicy data = 2;

  google.protobuf.FieldMask update_mask = 3 [
    (gnostic.openapi.v3.property) = {
      description: "List of fields to update",
      example: {yaml : "id,realname,username"}
    },
    json_name = "updateMask"
  ]; // List of fields to update

  optional bool allow_missing = 4 [
    (gnostic.openapi.v3.property) = {description: "If set to true, when the resource does not exist it will be created (inserted), and in this case the `updateMask` field will be ignored."},
    json_name = "allowMissing"
  ]; // If set to true, when the resource does not exist it will be created (inserted), and in this case the `updateMask` field will be ignored.
}

// Delete login policy - Request
message DeleteLoginPolicyRequest {
  uint32 id = 1;
}
