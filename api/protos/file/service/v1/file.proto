syntax = "proto3";

package file.service.v1;

import "gnostic/openapi/v3/annotations.proto";

import "google/api/field_behavior.proto";

import "google/protobuf/empty.proto";
import "google/protobuf/timestamp.proto";
import "google/protobuf/field_mask.proto";

import "pagination/v1/pagination.proto";

// File Service
service FileService {
  // Get file list
  rpc List (pagination.PagingRequest) returns (ListFileResponse) {}

  // Get file data
  rpc Get (GetFileRequest) returns (File) {}

  // Create file
  rpc Create (CreateFileRequest) returns (google.protobuf.Empty) {}

  // Update file
  rpc Update (UpdateFileRequest) returns (google.protobuf.Empty) {}

  // Delete file
  rpc Delete (DeleteFileRequest) returns (google.protobuf.Empty) {}
}

// OSS Provider
enum OSSProvider {
  MINIO = 0; // MinIO
  ALIYUN = 1; // Alibaba Cloud
  AWS = 2; // Amazon Web Services
  AZURE = 3; // Microsoft Azure
  BAIDU = 4; // Baidu Cloud
  QINIU = 5; // Qiniu Cloud
  TENCENT = 6; // Tencent Cloud
  GOOGLE = 7; // Google Cloud
  HUAWEI = 8; // Huawei Cloud

  LOCAL = 10; // Local file system
}

// File
message File {
  optional uint32 id = 1 [
    json_name = "id",
    (google.api.field_behavior) = OPTIONAL,
    (gnostic.openapi.v3.property) = { description: "File ID" }
  ]; // File ID

  optional OSSProvider provider = 2 [
    json_name = "provider",
    (gnostic.openapi.v3.property) = { description: "OSS provider" }
  ];  // OSS provider

  optional string bucket_name = 3 [
    json_name = "bucketName",
    (gnostic.openapi.v3.property) = { description: "Bucket name" }
  ];  // Bucket name

  optional string file_directory = 4 [
    json_name = "fileDirectory",
    (gnostic.openapi.v3.property) = {
      description: "File directory",
      example: {yaml : "tenant/1001/user/avatar/"}
    }
  ];  // File directory

  optional string file_guid = 5 [
    json_name = "fileGuid",
    (gnostic.openapi.v3.property) = { description: "File GUID" }
  ];  // File GUID

  optional string save_file_name = 6 [
    json_name = "saveFileName",
    (gnostic.openapi.v3.property) = {
      description: "Actual stored file name (to prevent file conflicts in the server file system)",
      example: {yaml : "f8a3b9c0-1234-5678-90ab-cdef12345678.pdf"}
    }
  ];  // Actual stored file name (to prevent file conflicts in the server file system)

  optional string file_name = 7 [
    json_name = "fileName",
    (gnostic.openapi.v3.property) = {
      description: "Original file name",
      example: {yaml : "2025_tax_return.pdf"}
    }
  ];  // Original file name

  optional string extension = 8 [
    json_name = "extension",
    (gnostic.openapi.v3.property) = {
      description: "File extension",
      example: {yaml : "pdf"}
    }
  ];  // File extension

  optional uint64 size = 9 [
    json_name = "size",
    (gnostic.openapi.v3.property) = { description: "File size in bytes" }
  ];  // File size in bytes

  optional string size_format = 10 [
    json_name = "sizeFormat",
    (gnostic.openapi.v3.property) = {
      description: "Formatted file size string",
      example: {yaml : "2.3 MB"}
    }
  ];  // Formatted file size string

  optional string link_url = 11 [
    json_name = "linkUrl",
    (gnostic.openapi.v3.property) = { description: "Link URL" }
  ];  // Link URL

  optional string content_hash = 12 [
    json_name = "contentHash",
    (gnostic.openapi.v3.property) = { description: "File content hash value" }
  ];  // File content hash value

  optional uint32 tenant_id = 40 [
    json_name = "tenantId",
    (gnostic.openapi.v3.property) = {description: "Tenant ID, 0 represents system global role"}
  ];  // Tenant ID, 0 represents system global role
  optional string tenant_name = 41 [
    json_name = "tenantName",
    (gnostic.openapi.v3.property) = {description: "Tenant name"}
  ];  // Tenant name

  optional uint32 created_by = 100 [json_name = "createdBy", (gnostic.openapi.v3.property) = {description: "Creator ID"}]; // Creator ID
  optional uint32 updated_by = 101 [json_name = "updatedBy", (gnostic.openapi.v3.property) = {description: "Updater ID"}]; // Updater ID
  optional uint32 deleted_by = 102 [json_name = "deletedBy", (gnostic.openapi.v3.property) = {description: "Deleter user ID"}]; // Deleter user ID

  optional google.protobuf.Timestamp created_at = 200 [json_name = "createdAt", (gnostic.openapi.v3.property) = {description: "Created time"}];// Created time
  optional google.protobuf.Timestamp updated_at = 201 [json_name = "updatedAt", (gnostic.openapi.v3.property) = {description: "Updated time"}];// Updated time
  optional google.protobuf.Timestamp deleted_at = 202 [json_name = "deletedAt", (gnostic.openapi.v3.property) = {description: "Deleted time"}];// Deleted time
}

// List Files - Response
message ListFileResponse {
  repeated File items = 1;
  uint64 total = 2;
}

// Get File - Request
message GetFileRequest {
  oneof query_by {
    uint32 id = 1 [
      (gnostic.openapi.v3.property) = {description: "ID", read_only: true},
      json_name = "id"
    ]; // ID
  }

  optional google.protobuf.FieldMask view_mask = 100 [
    json_name = "viewMask",
    (gnostic.openapi.v3.property) = {
      description: "View field filter, used to control which fields to return"
    }
  ]; // View field filter, used to control which fields to return
}

// Create File - Request
message CreateFileRequest {
  File data = 1;
}

// Update File - Request
message UpdateFileRequest {
  uint32 id = 1;

  File data = 2;

  google.protobuf.FieldMask update_mask = 3 [
    (gnostic.openapi.v3.property) = {
      description: "List of fields to update",
      example: {yaml : "id,realname,username"}
    },
    json_name = "updateMask"
  ]; // List of fields to update

  optional bool allow_missing = 4 [
    (gnostic.openapi.v3.property) = {description: "If set to true, the resource will be created (inserted) if it does not exist, and the `updateMask` field will be ignored in this case."},
    json_name = "allowMissing"
  ]; // If set to true, the resource will be created (inserted) if it does not exist, and the `updateMask` field will be ignored in this case.
}

// Delete File - Request
message DeleteFileRequest {
  uint32 id = 1;
}

message CountFileResponse {
  uint64 count = 1;
}
