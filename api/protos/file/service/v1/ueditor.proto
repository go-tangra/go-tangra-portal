syntax = "proto3";

package file.service.v1;

import "gnostic/openapi/v3/annotations.proto";
import "google/api/annotations.proto";
import "google/api/httpbody.proto";

// UEditor Backend Service
service UEditorService {
  // UEditor API
  rpc UEditorAPI (UEditorRequest) returns (UEditorResponse) {}

  // Upload file
  rpc UploadFile (UEditorUploadRequest) returns (UEditorUploadResponse) {}
}

// Action
enum UEditorAction {
  config = 0; // Configuration

  listFile = 1;// Files
  listImage = 2;// Images

  uploadFile = 10;// File
  uploadImage = 11;// Image
  uploadVideo = 12; // Video
  uploadScrawl = 13; // Scrawl image
  catchImage = 14; // Catch remote image
}

message UEditorRequest {
  string action = 1;
  string encode = 2;
  int32 start = 3;
  int32 size = 4;
}
message UEditorResponse {
  optional string imageActionName = 1;// Action name for uploading images
  optional string imageFieldName = 2;// Image form field name
  optional int64 imageMaxSize = 3;// Upload size limit in bytes
  repeated string imageAllowFiles = 4;// Allowed image formats
  optional bool imageCompressEnable = 5;// Whether to compress images, default is true
  optional int64 imageCompressBorder = 6;// Maximum edge length for image compression
  optional string imageInsertAlign = 7;// Image float alignment when inserted
  optional string imageUrlPrefix = 8;// Image access path prefix
  optional string imagePathFormat = 9;// Upload save path, can customize save path and filename format

  optional string scrawlActionName = 10;// Action name for uploading scrawl
  optional string scrawlFieldName = 11;// Scrawl form field name
  optional int64 scrawlMaxSize = 12;// Upload size limit in bytes
  optional string scrawlUrlPrefix = 13;// Image access path prefix
  optional string scrawlInsertAlign = 14;//
  optional string scrawlPathFormat = 15;// Upload save path, can customize save path and filename format

  optional string snapscreenActionName = 20;// Action name for uploading screenshots
  optional string snapscreenUrlPrefix = 21;// Image access path prefix
  optional string snapscreenInsertAlign = 22;// Image float alignment when inserted
  optional string snapscreenPathFormat = 23;// Upload save path, can customize save path and filename format

  optional string catcherActionName = 30;// Action name for catching remote images
  optional string catcherFieldName = 31;// Image list form field name
  repeated string catcherLocalDomain = 32;//
  optional string catcherUrlPrefix = 33;// Image access path prefix
  optional int64 catcherMaxSize = 34;// Upload size limit in bytes
  repeated string catcherAllowFiles = 35;// Allowed file types
  optional string catcherPathFormat = 36;// Upload save path, can customize save path and filename format

  optional string videoActionName = 40;// Action name for uploading videos
  optional string videoFieldName = 41;// Video form field name
  optional string videoUrlPrefix = 42;// Video access path prefix
  optional int64 videoMaxSize = 43;// Upload size limit in bytes, default 100MB
  repeated string videoAllowFiles = 44;// Allowed file types
  optional string videoPathFormat = 45;// Upload save path, can customize save path and filename format

  optional string fileActionName = 50;// Action name for uploading files
  optional string fileFieldName = 51;// File form field name
  optional string fileUrlPrefix = 52;// File access path prefix
  optional int64 fileMaxSize = 53;// Upload size limit in bytes, default 50MB
  repeated string fileAllowFiles = 54;// Allowed file types
  optional string filePathFormat = 55;// Upload save path, can customize save path and filename format

  optional string imageManagerActionName = 60;// Image list configuration
  optional int64 imageManagerListSize = 61;// Number of files to list per request
  optional string imageManagerUrlPrefix = 62;// Image access path prefix
  optional string imageManagerInsertAlign = 63;// Image float alignment when inserted, default: none
  repeated string imageManagerAllowFiles = 64; // Allowed file types
  optional string imageManagerListPath = 65; // Directory to list images from

  optional string fileManagerActionName = 70; // File list configuration
  optional string fileManagerUrlPrefix = 71;// Directory to list files from
  optional int64 fileManagerListSize = 72;// Number of files to list per request
  repeated string fileManagerAllowFiles = 73;// Allowed file types
  optional string FileManagerListPath = 74;// Allowed file types

  message FormulaConfig {
    string imageUrlTemplate = 1;// Formula rendering path
  }
  optional FormulaConfig formulaConfig = 80;// Formula configuration

  optional string state = 100; // Upload state, must return "SUCCESS" on successful upload

  optional int32 start = 101;
  optional int32 total = 102;

  message Item {
    string url = 1;
    int64 mtime = 2;
  }
  repeated Item list = 103;
}

message UEditorUploadRequest {
  optional string action = 1 [
    json_name = "action",
    (gnostic.openapi.v3.property) = { description: "Action" }
  ]; // Action

  optional bytes file = 2 [
    json_name = "file",
    (gnostic.openapi.v3.property) = { description: "File content" }
  ]; // File content

  optional string source_file_name = 3 [
    json_name = "sourceFileName",
    (gnostic.openapi.v3.property) = { description: "Original file name" }
  ]; // Original file name

  optional string mime = 4 [
    json_name = "mime",
    (gnostic.openapi.v3.property) = { description: "MIME type of the file" }
  ]; // MIME type of the file
}

message UEditorUploadResponse {
  optional string state = 1; // Upload state, must return "SUCCESS" on successful upload

  optional string url = 2;// Returned URL
  optional string title = 3;// New file name
  optional string original = 4;// Original file name
  optional string type = 5;// File type
  optional int32 size = 6; // File size

  message Item {
    string state = 1; // Upload state, must return "SUCCESS" on successful upload
    optional string url = 2; // Returned URL
    optional string title = 3;// New file name
    optional string original = 4;// Original file name
    optional string type = 5;// File type
    optional int32 size = 6; // File size
  }
  repeated Item list = 10;
}

message UEditorListResponse {
  string state = 1;

  int32 start = 2;
  int32 total = 3;

  message Item {
    string url = 1;
    int64 mtime = 2;
  }
  repeated Item list = 10;
}
