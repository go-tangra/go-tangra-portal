syntax = "proto3";

package user.service.v1;

import "gnostic/openapi/v3/annotations.proto";

import "google/protobuf/empty.proto";
import "google/protobuf/field_mask.proto";
import "google/protobuf/timestamp.proto";

import "pagination/v1/pagination.proto";
import "user/service/v1/user.proto";

// Tenant service
service TenantService {
  // Query tenant list
  rpc List (pagination.PagingRequest) returns (ListTenantResponse) {}

  // Query tenant details
  rpc Get (GetTenantRequest) returns (Tenant) {}

  // Create tenant
  rpc Create (CreateTenantRequest) returns (google.protobuf.Empty) {}

  // Update tenant
  rpc Update (UpdateTenantRequest) returns (google.protobuf.Empty) {}

  // Delete tenant
  rpc Delete (DeleteTenantRequest) returns (google.protobuf.Empty) {}

  // Batch create tenants
  rpc BatchCreate (BatchCreateTenantsRequest) returns ( BatchCreateTenantsResponse ) {}

  // Check if tenant exists
  rpc TenantExists ( TenantExistsRequest ) returns ( TenantExistsResponse ) {}
}

// Tenant
message Tenant {
  // Tenant status
  enum Status {
    OFF = 0;         // Disabled
    ON = 1;          // Enabled
    EXPIRED = 2;     // Expired
    FREEZE = 3;      // Frozen
  }

  // Tenant type
  enum Type {
    TENANT_TYPE_UNSPECIFIED = 0; // Unspecified

    TRIAL = 1;       // Trial
    PAID = 2;        // Paid
    INTERNAL = 3;    // Internal
    PARTNER = 4;     // Partner
    CUSTOM = 5;      // Custom
  }

  // Tenant audit status
  enum AuditStatus {
    TENANT_AUDIT_STATUS_UNSPECIFIED = 0; // Unspecified

    PENDING = 1;      // Pending review
    APPROVED = 2;     // Approved
    REJECTED = 3;     // Rejected
  }

  optional uint32 id = 1 [
    json_name = "id",
    (gnostic.openapi.v3.property) = {description: "Tenant ID"}
  ];  // Tenant ID

  optional string name = 2 [
    json_name = "name",
    (gnostic.openapi.v3.property) = {description: "Tenant name"}
  ];  // Tenant name

  optional string code = 3 [
    json_name = "code",
    (gnostic.openapi.v3.property) = {description: "Tenant code"}
  ];  // Tenant code

  optional string domain = 4 [
    json_name = "domain",
    (gnostic.openapi.v3.property) = {description: "Tenant dedicated domain"}
  ];  // Tenant dedicated domain

  optional string logo_url = 5 [
    json_name = "logoUrl",
    (gnostic.openapi.v3.property) = {description: "Tenant logo URL"}
  ];  // Tenant logo URL

  optional string industry = 6 [
    json_name = "industry",
    (gnostic.openapi.v3.property) = {description: "Industry (e.g., 'Internet', 'Finance', 'Manufacturing')"}
  ];  // Industry

  optional Type type = 7 [(gnostic.openapi.v3.property) = {description: "Tenant type"}]; // Tenant type

  optional string remark = 8 [
    json_name = "remark",
    (gnostic.openapi.v3.property) = {description: "Remark"}
  ]; // Remark

  optional uint32 admin_user_id = 10 [
    json_name = "adminUserId",
    (gnostic.openapi.v3.property) = {description: "Admin user ID"}
  ];  // Admin user ID

  optional string admin_user_name = 11 [
    json_name = "adminUserName",
    (gnostic.openapi.v3.property) = {description: "Admin username"}
  ];  // Admin username

  optional google.protobuf.Timestamp subscription_at = 20 [
    json_name = "subscriptionAt",
    (gnostic.openapi.v3.property) = {description: "Subscription time (first subscription/renewal time, NULL means not subscribed)"}
  ]; // Subscription time (first subscription/renewal time, NULL means not subscribed)
  optional google.protobuf.Timestamp unsubscribe_at = 21 [
    json_name = "unsubscribeAt",
    (gnostic.openapi.v3.property) = {description: "Unsubscription time"}
  ]; // Unsubscription time (NULL means not unsubscribed)
  optional google.protobuf.Timestamp expired_at = 22 [
    json_name = "expiredAt",
    (gnostic.openapi.v3.property) = {description: "Tenant validity period (NULL means permanent, status changes to 'expired' after expiration)"}
  ]; // Tenant validity period (NULL means permanent, status changes to "expired" after expiration)
  optional string subscription_plan = 23 [
    json_name = "subscriptionPlan",
    (gnostic.openapi.v3.property) = {description: "Subscription plan (e.g., 'Enterprise 1 year', 'Basic 3 months')"}
  ]; // Subscription plan (e.g., "Enterprise 1 year", "Basic 3 months")

  optional int32 member_count = 30 [
    json_name = "memberCount",
    (gnostic.openapi.v3.property) = {description: "Member count"}
  ];  // Member count

  optional Status status = 31 [(gnostic.openapi.v3.property) = {description: "Tenant status"}]; // Tenant status

  optional AuditStatus audit_status = 32 [
    json_name = "auditStatus",
    (gnostic.openapi.v3.property) = {description: "Audit status"}
  ]; // Audit status

  optional uint32 created_by = 100 [json_name = "createdBy", (gnostic.openapi.v3.property) = {description: "Creator ID"}]; // Creator ID
  optional uint32 updated_by = 101 [json_name = "updatedBy", (gnostic.openapi.v3.property) = {description: "Updater ID"}]; // Updater ID
  optional uint32 deleted_by = 102 [json_name = "deletedBy", (gnostic.openapi.v3.property) = {description: "Deleter user ID"}]; // Deleter user ID

  optional google.protobuf.Timestamp created_at = 200 [json_name = "createdAt", (gnostic.openapi.v3.property) = {description: "Created time"}];// Created time
  optional google.protobuf.Timestamp updated_at = 201 [json_name = "updatedAt", (gnostic.openapi.v3.property) = {description: "Updated time"}];// Updated time
  optional google.protobuf.Timestamp deleted_at = 202 [json_name = "deletedAt", (gnostic.openapi.v3.property) = {description: "Deleted time"}];// Deleted time
}

// Tenant list - Response
message ListTenantResponse {
  repeated Tenant items = 1;
  uint64 total = 2;
}

// Tenant data - Request
message GetTenantRequest {
  oneof query_by {
    uint32 id = 1 [
      (gnostic.openapi.v3.property) = {description: "ID", read_only: true},
      json_name = "id"
    ]; // ID

    string code = 2 [
      (gnostic.openapi.v3.property) = {description: "Tenant code", read_only: true},
      json_name = "code"
    ]; // Tenant code

    string name = 3 [
      (gnostic.openapi.v3.property) = {description: "Tenant name", read_only: true},
      json_name = "name"
    ]; // Tenant name
  }

  optional google.protobuf.FieldMask view_mask = 100 [
    json_name = "viewMask",
    (gnostic.openapi.v3.property) = {
      description: "View field mask for controlling returned fields"
    }
  ]; // View field mask for controlling returned fields
}

// Create tenant - Request
message CreateTenantRequest {
  Tenant data = 1;
}

// Update tenant - Request
message UpdateTenantRequest {
  uint32 id = 1;

  Tenant data = 2;

  google.protobuf.FieldMask update_mask = 3 [
    (gnostic.openapi.v3.property) = {
      description: "List of fields to update",
      example: {yaml : "id,realname,username"}
    },
    json_name = "updateMask"
  ]; // List of fields to update

  optional bool allow_missing = 4 [
    (gnostic.openapi.v3.property) = {description: "If set to true and the resource does not exist, it will be created (inserted), and the `updateMask` field will be ignored."},
    json_name = "allowMissing"
  ]; // If set to true and the resource does not exist, it will be created (inserted), and the `updateMask` field will be ignored.
}

// Delete tenant - Request
message DeleteTenantRequest {
  uint32 id = 1;
}

message BatchCreateTenantsRequest {
  repeated Tenant data = 1;
}
message BatchCreateTenantsResponse {
  repeated int32 created_ids = 1 [
    json_name = "createdIds",
    (gnostic.openapi.v3.property) = {
      description: "List of successfully created tenant IDs"
    }
  ]; // List of successfully created tenant IDs
}

// Check tenant exists - Request
message TenantExistsRequest {
  string code = 1 [
    (gnostic.openapi.v3.property) = {description: "Tenant code", read_only: true},
    json_name = "code"
  ]; // Tenant code

  string name = 2 [
    (gnostic.openapi.v3.property) = {description: "Tenant name", read_only: true},
    json_name = "name"
  ]; // Tenant name
}
// Check tenant exists - Response
message TenantExistsResponse {
  bool exist = 1;
}


// Create tenant with admin user - Request
message CreateTenantWithAdminUserRequest {
  user.service.v1.Tenant tenant = 1;
  user.service.v1.User user = 2;
  string password = 3;
}

