syntax = "proto3";

package user.service.v1;

import "gnostic/openapi/v3/annotations.proto";
import "google/protobuf/empty.proto";
import "google/protobuf/timestamp.proto";
import "google/protobuf/field_mask.proto";

import "pagination/v1/pagination.proto";

// Organization unit service
service OrgUnitService {
  // Query organization unit list
  rpc List (pagination.PagingRequest) returns (ListOrgUnitResponse) {}

  // Query organization unit details
  rpc Get (GetOrgUnitRequest) returns (OrgUnit) {}

  // Create organization unit
  rpc Create (CreateOrgUnitRequest) returns (google.protobuf.Empty) {}

  // Update organization unit
  rpc Update (UpdateOrgUnitRequest) returns (google.protobuf.Empty) {}

  // Delete organization unit
  rpc Delete (DeleteOrgUnitRequest) returns (google.protobuf.Empty) {}

  // Batch create organization units
  rpc BatchCreate (BatchCreateOrgUnitsRequest) returns (BatchCreateOrgUnitsResponse) {}
}

// Organization unit
message OrgUnit {
  // Organization unit status
  enum Status {
    OFF = 0;         // Disabled
    ON = 1;          // Enabled
  }

  // Organization unit type
  enum Type {
    COMPANY = 0;      // Company
    DIVISION = 1;     // Division
    DEPARTMENT = 2;   // Department
    TEAM = 3;         // Team
    PROJECT = 4;      // Project
    COMMITTEE = 5;    // Committee
    REGION = 6;       // Region
    SUBSIDIARY = 7;   // Subsidiary
    BRANCH = 8;       // Branch

    OTHER = 100;      // Other
  }

  optional uint32 id = 1 [
    json_name = "id",
    (gnostic.openapi.v3.property) = {description: "Organization unit ID"}
  ];  // Organization unit ID

  optional string name = 2 [json_name = "name", (gnostic.openapi.v3.property) = {description: "Organization unit name"}];  // Organization unit name
  optional string code = 3 [json_name = "code", (gnostic.openapi.v3.property) = {description: "Unique code (suggested format: department code + org unit type + sequence, e.g., 'FIN-LEADER-001'), used for data sync and quick identification"}];  // Unique code (suggested format: department code + org unit type + sequence, e.g., "FIN-LEADER-001"), used for data sync and quick identification
  optional Type type = 4 [json_name = "type", (gnostic.openapi.v3.property) = {description: "Organization type"}];  // Organization type
  optional string path = 5 [json_name = "path", (gnostic.openapi.v3.property) = {description: "Tree path"}];  // Tree path

  optional Status status = 6 [(gnostic.openapi.v3.property) = {description: "Status"}]; // Status
  optional uint32 sort_order = 7 [
    json_name = "sortOrder",
    (gnostic.openapi.v3.property) = {description: "Sort order, smaller values appear first"}
  ];  // Sort order, smaller values appear first

  optional uint32 leader_id = 10 [
    json_name = "leaderId",
    (gnostic.openapi.v3.property) = {description: "Leader user ID"}
  ];  // Leader user ID

  optional string leader_name = 11 [
    json_name = "leaderName",
    (gnostic.openapi.v3.property) = {description: "Leader user name"}
  ];  // Leader user name

  optional uint32 tenant_id = 12 [json_name = "tenantId", (gnostic.openapi.v3.property) = {description: "Tenant ID"}];  // Tenant ID
  optional string tenant_name = 13 [json_name = "tenantName", (gnostic.openapi.v3.property) = {description: "Tenant name"}];  // Tenant name

  optional string remark = 20 [json_name = "remark", (gnostic.openapi.v3.property) = {description: "Remark"}];  // Remark
  optional string description = 21 [json_name = "description", (gnostic.openapi.v3.property) = {description: "Description"}];  // Description
  repeated string business_scopes = 22 [
    json_name = "businessScopes",
    (gnostic.openapi.v3.property) = {description: "Organization business scopes/service lines, supports multiple values for filtering, permission mapping and sync"}
  ]; // Organization business scopes/service lines

  optional string external_id = 100 [
    json_name = "externalId",
    (gnostic.openapi.v3.property) = {description: "External system ID"}
  ]; // External system ID
  optional bool is_legal_entity = 101 [
    json_name = "isLegalEntity",
    (gnostic.openapi.v3.property) = {description: "Whether this is a legal entity"}
  ]; // Whether this is a legal entity
  optional string registration_number = 102 [
    json_name = "registrationNumber",
    (gnostic.openapi.v3.property) = {description: "Registration number/Unified social credit code"}
  ]; // Registration number/Unified social credit code
  optional string tax_id = 103 [
    json_name = "taxId",
    (gnostic.openapi.v3.property) = {description: "Tax ID"}
  ]; // Tax ID
  optional uint32 legal_entity_org_id = 104 [
    json_name = "legalEntityOrgId",
    (gnostic.openapi.v3.property) = {description: "Associated legal entity organization ID (if any)"}
  ]; // Associated legal entity organization ID (if any)
  optional string address = 105 [
    json_name = "address",
    (gnostic.openapi.v3.property) = {description: "Detailed address"}
  ]; // Detailed address
  optional string phone = 106 [
    json_name = "phone",
    (gnostic.openapi.v3.property) = {description: "Contact phone"}
  ]; // Contact phone
  optional string email = 107 [
    json_name = "email",
    (gnostic.openapi.v3.property) = {description: "Contact email"}
  ]; // Contact email
  optional string timezone = 108 [
    json_name = "timezone",
    (gnostic.openapi.v3.property) = {description: "Timezone, e.g., Asia/Shanghai"}
  ]; // Timezone, e.g., "Asia/Shanghai"
  optional string country = 109 [
    json_name = "country",
    (gnostic.openapi.v3.property) = {description: "Country/Region code"}
  ]; // Country/Region code

  optional double latitude = 110 [
    json_name = "latitude",
    (gnostic.openapi.v3.property) = {description: "Latitude"}
  ]; // Latitude (optional)
  optional double longitude = 111 [
    json_name = "longitude",
    (gnostic.openapi.v3.property) = {description: "Longitude"}
  ]; // Longitude (optional)

  optional google.protobuf.Timestamp start_at = 112 [
    json_name = "startAt",
    (gnostic.openapi.v3.property) = {description: "Effective start time (UTC)"}
  ]; // Effective start time (UTC)
  optional google.protobuf.Timestamp end_at = 113 [
    json_name = "endAt",
    (gnostic.openapi.v3.property) = {description: "Effective end time (UTC)"}
  ]; // Effective end time (UTC)

  map<string, string> attributes = 114 [
    json_name = "attributes",
    (gnostic.openapi.v3.property) = {description: "Custom extended attributes"}
  ]; // Custom extended attributes
  repeated string permission_tags = 115 [
    json_name = "permissionTags",
    (gnostic.openapi.v3.property) = {description: "Tags for permission/role mapping"}
  ]; // Tags for permission/role mapping

  optional uint32 contact_user_id = 116 [
    json_name = "contactUserId",
    (gnostic.openapi.v3.property) = {description: "Business contact user ID"}
  ]; // Business contact user ID
  optional string contact_user_name = 117 [
    json_name = "contactUserName",
    (gnostic.openapi.v3.property) = {description: "Business contact user name"}
  ]; // Business contact user name

  optional uint32 parent_id = 500 [json_name = "parentId", (gnostic.openapi.v3.property) = {description: "Parent node ID"}];  // Parent node ID
  repeated OrgUnit children = 501 [json_name = "children", (gnostic.openapi.v3.property) = {description: "Children node tree"}];  // Children node tree

  optional uint32 created_by = 510 [json_name = "createdBy", (gnostic.openapi.v3.property) = {description: "Creator ID"}]; // Creator ID
  optional uint32 updated_by = 511 [json_name = "updatedBy", (gnostic.openapi.v3.property) = {description: "Updater ID"}]; // Updater ID
  optional uint32 deleted_by = 512 [json_name = "deletedBy", (gnostic.openapi.v3.property) = {description: "Deleter user ID"}]; // Deleter user ID

  optional google.protobuf.Timestamp created_at = 520 [json_name = "createdAt", (gnostic.openapi.v3.property) = {description: "Created time"}];// Created time
  optional google.protobuf.Timestamp updated_at = 521 [json_name = "updatedAt", (gnostic.openapi.v3.property) = {description: "Updated time"}];// Updated time
  optional google.protobuf.Timestamp deleted_at = 522 [json_name = "deletedAt", (gnostic.openapi.v3.property) = {description: "Deleted time"}];// Deleted time
}

// List organization units - Response
message ListOrgUnitResponse {
  repeated OrgUnit items = 1;
  uint64 total = 2;
}

// Get organization unit data - Request
message GetOrgUnitRequest {
  oneof query_by {
    uint32 id = 1 [
      (gnostic.openapi.v3.property) = {description: "ID", read_only: true},
      json_name = "id"
    ]; // ID
  }

  optional google.protobuf.FieldMask view_mask = 100 [
    json_name = "viewMask",
    (gnostic.openapi.v3.property) = {
      description: "View field mask for controlling returned fields"
    }
  ]; // View field mask for controlling returned fields
}

// Create organization unit - Request
message CreateOrgUnitRequest {
  OrgUnit data = 1;
}

// Update organization unit - Request
message UpdateOrgUnitRequest {
  uint32 id = 1;

  OrgUnit data = 2;

  google.protobuf.FieldMask update_mask = 3 [
    (gnostic.openapi.v3.property) = {
      description: "List of fields to update",
      example: {yaml : "id,realname,username"}
    },
    json_name = "updateMask"
  ]; // List of fields to update

  optional bool allow_missing = 4 [
    (gnostic.openapi.v3.property) = {description: "If set to true and the resource does not exist, it will be created (inserted), and the `updateMask` field will be ignored."},
    json_name = "allowMissing"
  ]; // If set to true and the resource does not exist, it will be created (inserted), and the `updateMask` field will be ignored.
}

// Delete organization unit - Request
message DeleteOrgUnitRequest {
  uint32 id = 1;
}

message BatchCreateOrgUnitsRequest {
  repeated OrgUnit data = 1;
}
message BatchCreateOrgUnitsResponse {
  repeated int32 created_ids = 1 [
    json_name = "createdIds",
    (gnostic.openapi.v3.property) = {
      description: "List of successfully created organization unit IDs"
    }
  ]; // List of successfully created organization unit IDs
}
